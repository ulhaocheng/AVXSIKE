/**
 *******************************************************************************
 * @version 0.1
 * @date 2021-12-16
 * @copyright Copyright Â© 2021 by University of Luxembourg
 * @author Hao Cheng
 *******************************************************************************
 */

#ifndef _SIDH_H
#define _SIDH_H

#include "curve.h"
#include "utils.h"
#include "random.h"

static const uint64_t vA_gen[6*VNWORDS] = {
  0x20C045626B624, 0x165B3E831BAE8, 0x7FB6361ADFD8D, 0x0B44661935869,
  0x3D351D2268BA0, 0x5C6105FFE37DF, 0x058494AAC660F, 0x5C97B696CB49D,
  0x566AB876E7828, 0x007DA68D550CE, // XPA0
  0x5506E325B4546, 0x7606B0D1363F1, 0x7703DD9D3ADAE, 0x78A581444339C,
  0x2ACF919963F36, 0x5F4E28479BF50, 0x2BE013EB07E8B, 0x03B2E946C90F2,
  0x598933943CCE5, 0x002DB91E4E1D5, // XPA1
  0x0DA5441F40EEB, 0x4C802F17E7A6C, 0x30DECF2221F32, 0x27C8F1CD5C45E,
  0x46660B6D44449, 0x26E4166AB8724, 0x729C8A2DD3635, 0x0A8294016D974,
  0x7048AEF43BCB7, 0x00285CA4C60BE, // XQA0
  0x53F8D00AF2B91, 0x6D4196C57686B, 0x4BD837EDF5B8C, 0x3EC770D79E0DC,
  0x634A8A4CE83E8, 0x107FB0E8135A1, 0x441055B3D5D8A, 0x17628BBA9FA16,
  0x53702E68C87C5, 0x0063A6EF19136, // XQA1 
  0x74CB4B721DF05, 0x47B8EAD8158EC, 0x360C1175517CD, 0x319072B5F71ED,
  0x0FB8C6B217E42, 0x62AA7FF3D5F95, 0x355CBED577986, 0x7C528AA9733DC,
  0x1943E41042E1A, 0x00760735358CF, // XRA0
  0x1B2AC3DCF0B96, 0x0A47D967CE623, 0x1E470A07B1817, 0x75830E7D0F813,
  0x2FC5EB1B45E9E, 0x008ADBAB1F09D, 0x434126DB0EDA6, 0x5F80B8FB70DEC,
  0x195160C684BD5, 0x0063DA901B255, // XRA1
};

static const uint64_t vB_gen[6*VNWORDS] = {
  0x0C3F17EC91A36, 0x20E08102076FB, 0x76511FCC30C55, 0x19BA79B9330F6,
  0x7E52D6824D4F4, 0x25E37369CBD88, 0x09B0580EDD73F, 0x3435C8FAA4FBB,
  0x1EC20E916EC81, 0x006F0277BD029, // XPB0
  0x0000000000000, 0x0000000000000, 0x0000000000000, 0x0000000000000, 
  0x0000000000000, 0x0000000000000, 0x0000000000000, 0x0000000000000, 
  0x0000000000000, 0x0000000000000, // XPB1
  0x515E84AD0A498, 0x744B13EE7C171, 0x1DB73F6311F94, 0x2A82B6E3931FA,
  0x789C76DF73F08, 0x4D21360F95B77, 0x4F92B3EBE4C9D, 0x6217D5E6AD20F,
  0x14A954FF06FA1, 0x003B1183C75CE, // XQB0
  0x0000000000000, 0x0000000000000, 0x0000000000000, 0x0000000000000, 
  0x0000000000000, 0x0000000000000, 0x0000000000000, 0x0000000000000, 
  0x0000000000000, 0x0000000000000, // XQB1
  0x22EE6504F4A54, 0x33E68446B9170, 0x1752245D30214, 0x3CB84202F5F0B,
  0x5F8C53B63FF67, 0x27A13BC379AE3, 0x2240DC04F1710, 0x48F88540DB3CD,
  0x550ECECCDB3C6, 0x0047469FB19FB, // XRB0
  0x00FFCD0BD7CC1, 0x26BDA5B72B01F, 0x280E71F993D60, 0x730500825E9B2,
  0x43FF727BE642C, 0x2732628B02498, 0x2AC8B0BBD7E58, 0x74834BE26E9E8,
  0x4D301F56F0DF7, 0x001CB667EB0FE, // XRB1  
};

// Fixed parameters for isogeny tree computation
static const unsigned int strat_Alice[MAX_Alice-1] = { 
  61, 32, 16, 8, 4, 2, 1, 1, 2, 1, 1, 4, 2, 1, 1, 2, 1, 1, 8, 4, 2, 1, 1, 2, 1, 1, 
  4, 2, 1, 1, 2, 1, 1, 16, 8, 4, 2, 1, 1, 2, 1, 1, 4, 2, 1, 1, 2, 1, 1, 8, 4, 2, 1, 
  1, 2, 1, 1, 4, 2, 1, 1, 2, 1, 1, 29, 16, 8, 4, 2, 1, 1, 2, 1, 1, 4, 2, 1, 1, 2, 1, 
  1, 8, 4, 2, 1, 1, 2, 1, 1, 4, 2, 1, 1, 2, 1, 1, 13, 8, 4, 2, 1, 1, 2, 1, 1, 4, 2, 
  1, 1, 2, 1, 1, 5, 4, 2, 1, 1, 2, 1, 1, 2, 1, 1, 1 };

static const unsigned int strat_Bob[MAX_Bob-1] = { 
  71, 38, 21, 13, 8, 4, 2, 1, 1, 2, 1, 1, 4, 2, 1, 1, 2, 1, 1, 5, 4, 2, 1, 1, 2, 1, 
  1, 2, 1, 1, 1, 9, 5, 3, 2, 1, 1, 1, 1, 2, 1, 1, 1, 4, 2, 1, 1, 1, 2, 1, 1, 17, 9, 
  5, 3, 2, 1, 1, 1, 1, 2, 1, 1, 1, 4, 2, 1, 1, 1, 2, 1, 1, 8, 4, 2, 1, 1, 1, 2, 1, 
  1, 4, 2, 1, 1, 2, 1, 1, 33, 17, 9, 5, 3, 2, 1, 1, 1, 1, 2, 1, 1, 1, 4, 2, 1, 1, 1, 
  2, 1, 1, 8, 4, 2, 1, 1, 1, 2, 1, 1, 4, 2, 1, 1, 2, 1, 1, 16, 8, 4, 2, 1, 1, 1, 2, 
  1, 1, 4, 2, 1, 1, 2, 1, 1, 8, 4, 2, 1, 1, 2, 1, 1, 4, 2, 1, 1, 2, 1, 1 };

// 2^512 * 4 = 2^514
static const uint64_t montRx4[NWORDS_FIELD] = {
  0x0000000000000FE6, 0x0000000000000000, 0x0000000000000000, 0x7800000000000000, 
  0x691BB20657577B91, 0x0E6A88A4A2FDD297, 0x6AAA51A0B5D9BB69, 0x001B20D0953B2911, };

// 2^512 / 4 = 2^510 
static const uint64_t montRdiv4[NWORDS_FIELD] = {
  0x00000000000000FE, 0x0000000000000000, 0x0000000000000000, 0x5800000000000000, 
  0x1DB4DD92323C2E95, 0x9B412515787F4C4B, 0x7AC4CFA13D4A7984, 0x0019D8A901E41DDC, };

void random_mod_order_B(unsigned char* random_digits);

void EphemeralKeyGeneration_A(const unsigned char* PrivateKeyA, unsigned char* PublicKeyA);
void EphemeralKeyGeneration_B(const unsigned char* PrivateKeyB, unsigned char* PublicKeyB);
void EphemeralSecretAgreement_A(const unsigned char* PrivateKeyA, const unsigned char* PublicKeyB, unsigned char* SharedSecretA);
void EphemeralSecretAgreement_B(const unsigned char* PrivateKeyB, const unsigned char* PublicKeyA, unsigned char* SharedSecretB);

void EphemeralKeyGenSecAgr_A_parallel(const unsigned char* PrivateKeyA, unsigned char* PublicKeyA, const unsigned char* PublicKeyB, unsigned char* SharedSecretA);

#endif

// p := 0x04066F541811E1E6045C6BDDA77A4D01B9BF6C87B7E7DAF13085BDA2211E7A0ABFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF;

// XPA0 := 0x002ED31A03825FA14BC1D92C503C061D843223E611A92D7C5FBEC0F2C915EE7EEE73374DF6A1161EA00CDCB786155E21FD38220C3772CE670BC68274B851678;
// XPA1 := 0x01EE4E4E9448FBBAB4B5BAEF280A99B7BF86A1CE05D55BD603C3BA9D7C08FD8DE7968B49A78851FFBC6D0A17CB2FA1B57F3BABEF87720DD9A489B5581F915D2;
// XQA0 := 0x0325CF6A8E2C6183A8B9932198039A7F965BA8587B67925D08D809DBF9A69DE1B621F7F134FA2DAB82FF5A2615F92CC71419FFFAAF86A290D604AB167616461;
// XQA1 := 0x03E7B0494C8E60A8B72308AE09ED34845B34EA0911E356B77A11872CF7FEEFF745D98D0624097BC1AD7CD2ADF7FFC2C1AA5BA3C6684B964FA555A0715E57DB1;
// XRA0 := 0x03D24CF1F347F1DA54C1696442E6AFC192CEE5E320905E0EAB3C9D3FB595CA26C154F39427A0416A9F36337354CF1E6E5AEDD73DF80C710026D49550AC8CE9F;
// XRA1 := 0x006869EA28E4CEE05DCEE8B08ACD59775D03DAA0DC8B094C85156C212C23C72CB2AB2D2D90D46375AA6D66E58E44F8F219431D3006FDED7993F51649C029498;

// XPB0 := 0x032D03FD1E99ED0CB05C0707AF74617CBEA5AC6B75905B4B54B1B0C2D73697840155E7B1005EFB02B5D02797A8B66A5D258C76A3C9EF745CECE11E9A178BADF;
// XQB0 := 0x039014A74763076675D24CF3FA28318DAC75BCB04E54ADDC6494693F72EBB7DA7DC6A3BBCD188DAD5BECE9D6BB4ABDD05DB38C5FBE52D985DCAF74422C24D53;
// XRB0 := 0x000C1465FD048FFB8BF2158ED57F0CFFF0C4D5A4397C7542D722567700FDBB8B2825CAB4B725764F5F528294B7F95C17D560E25660AD3D07AB011D95B2CB522;
// XRB1 := 0x0288165466888BE1E78DB339034E2B8C7BDF0483BFA7AB943DFA05B2D1712317916690F5E713740E7C7D4838296E67357DC34E3460A95C330D5169721981758;
